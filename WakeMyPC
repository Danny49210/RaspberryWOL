from flask import Flask
import subprocess

app = Flask(__name__)

# MAC address of the device to wake
MAC_ADDRESS = '7B:2A:83:DB:71:78'
# Network interface (change to your Raspberry Pi's interface)
INTERFACE = 'wlan0'

# Function to run etherwake command
def run_etherwake(mac_address, interface):
    try:
        # Build the etherwake command
        command = ['sudo', 'etherwake', '-b', mac_address, '-i', interface]
        # Execute the command
        subprocess.run(command, check=True)
        print(f"etherwake command executed: {command}")
        return f"Magic packet sent via etherwake to {mac_address} using {interface}", 200
    except subprocess.CalledProcessError as e:
        print(f"Error executing etherwake command: {str(e)}")
        return f"Error sending magic packet: {str(e)}", 500

@app.route('/wake', methods=['GET'])
def wake():
    # Call the run_etherwake function
    print(f"Sending magic packet to {MAC_ADDRESS} using {INTERFACE}")
    return run_etherwake(MAC_ADDRESS, INTERFACE)

if __name__ == '__main__':
    # Run the Flask app on port 5000 (accessible within your network)
    app.run(host='0.0.0.0', port=5000)
